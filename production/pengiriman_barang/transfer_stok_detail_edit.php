<?php     require_once("../penghubung.inc.php");     require_once($ROOT."lib/bit.php");     require_once($ROOT."lib/login.php");     require_once($ROOT."lib/encrypt.php");     require_once($ROOT."lib/datamodel.php");     require_once($ROOT."lib/expAJAX.php");	   require_once($ROOT."lib/tampilan.php");		   require_once($ROOT."lib/currency.php");          $view = new CView($_SERVER['PHP_SELF'],$_SERVER['QUERY_STRING']);     $dtaccess = new DataAccess();     $enc = new textEncrypt();     	   $auth = new CAuth();     $err_code = 0;          $userData = $auth->GetUserData();     if($_POST["transfer_id"])         {       $transferId = & $_POST["transfer_id"];       }     else if($_GET["id"])       {       $transferId = $enc->Decode($_GET["id"]);      }                   if($_GET["klinik"]) $_POST["klinik"] = $_GET["klinik"];        $editPage = "transfer_stok_detail_edit.php?id=".$enc->Encode($transferId)."&klinik=".$_POST["klinik"];    $thisPage = "transfer_stok_detail_view.php?id=".$enc->Encode($transferId)."&klinik=".$_POST["klinik"];    $transferPage = "transfer_stok_view.php";    $findPage = "item_find.php?id=".$enc->Encode($transferId);	        	  if ($_POST["btnUpdateLagi"] || $_POST["btnSaveLagi"]) 	  {	       $backPage = "transfer_stok_detail_edit.php?id=".$enc->Encode($transferId)."&klinik=".$_POST["klinik"];	  }	  else	  {         $backPage = "transfer_stok_detail_view.php?id=".$enc->Encode($transferId)."&klinik=".$_POST["klinik"];    }        // AMBIL DATA TGL KELUAR TRANSAKSI //    if($_GET["tgl"])  $_POST["tgl_keluar"] = $_GET["tgl"];	       /*if(!$auth->IsAllowed("transfer_stok",PRIV_READ)){          die("access_denied");          exit(1);               } elseif($auth->IsAllowed("transfer_stok",PRIV_READ)===1){          echo"<script>window.parent.document.location.href='".$ROOT."login.php?msg=Session Expired'</script>";          exit(1);     }*/		if($_POST["x_mode"]||$_POST["btnCetak"]) $_x_mode = & $_POST["x_mode"];	else $_x_mode = "New";		if($_POST["btnCetak"]){  //Untuk cetak        $_x_mode = "Cetak" ;  }	if($_POST["transfer_detail_id"])  $transferBufferDetailId = & $_POST["transfer_detail_id"];      if ($_GET["transfer_detail_id"]) {          if ($_POST["btnDelete"]) {                $_x_mode = "Delete";          }          else {                $_x_mode = "Edit";               $transferBufferDetailId = $enc->Decode($_GET["transfer_detail_id"]);          }                   $sql = "select a.*,b.item_nama,c.jenis_nama , d.batch_stok_saldo, a.id_dep as kliniks , a.id_batch, d.batch_no, d.batch_tgl_jatuh_tempo                  from logistik_transfer_stok_detail a                  left join logistik_item b on a.id_item = b.item_id                  left join global.global_jenis_pasien c on b.item_tipe_jenis = c.jenis_id                  left join logistik_item_batch d on d.batch_id = a.id_batch        				  where a.transfer_detail_id = ".QuoteValue(DPE_CHAR,$transferBufferDetailId).                  " and a.id_transfer = ".QuoteValue(DPE_CHAR,$transferId).                   " order by b.item_nama asc";          $rs_edit = $dtaccess->Execute($sql,DB_SCHEMA_LOGISTIK);          $row_edit = $dtaccess->Fetch($rs_edit);          $dtaccess->Clear($rs_edit);                    $_POST["item_id"] = $row_edit["id_item"];          $_POST["item_nama"] = $row_edit["item_nama"];          $_POST["stok"] = currency_format($row_edit["batch_stok_saldo"]);          $_POST["jenis_nama"] = $row_edit["jenis_nama"];          $_POST["transfer_detail_jumlah"] = currency_format($row_edit["transfer_detail_jumlah"]);          $_POST["klinik"] = $row_edit["kliniks"];          $_POST["id_batch"] = $row_edit["id_batch"];          $_POST["nomor_batch"] = $row_edit["batch_no"];          $_POST["exp_date_batch"] = format_date($row_edit["batch_tgl_jatuh_tempo"]);               }         	if($_x_mode=="New") $privMode = PRIV_CREATE;	elseif($_x_mode=="Edit") $privMode = PRIV_UPDATE;	else $privMode = PRIV_DELETE;         if ($_POST["btnNew"]) {          header("location: ".$_SERVER["PHP_SELF"]);          exit();     }        if ($_POST["btnSave"] || $_POST["btnUpdate"] || $_POST["btnSaveLagi"] || $_POST["btnUpdateLagi"]) {              // cek apakah ada item yg di masukkan ngga ???       if(!$_POST["transfer_detail_jumlah"] && !$_POST["item_id"]) {                         // Tampilkan warning kalau gak ada datanya..             echo "<script>alert('Maaf , Belum ada Item Barang dan Jumlah Stok yang di masukkan');</script>";             echo "<script>document.location.href='transfer_stok_detail_edit.php?klinik=".$_POST["klinik"]."&id=".$enc->Encode($transferId)."&tgl=".$_POST["tgl_keluar"]."'</script>;";             exit();              }              // cek jika item jumlah yg di maasukkan kebanyakan //       if(StripCurrency($_POST["transfer_detail_jumlah"])>StripCurrency($_POST["stok"])) {                         // Tampilkan warning kalau gak ada datanya..             echo "<script>alert('Maaf, Jumlah Stok yang dimasukkan kelebihan, Maksimal : ".$_POST["stok"]." ');</script>";             echo "<script>document.location.href='transfer_stok_detail_edit.php?klinik=".$_POST["klinik"]."&id=".$enc->Encode($transferId)."&tgl=".$_POST["tgl_keluar"]."'</script>;";             exit();              }                       if($_POST["btnUpdate"]){               $transferBufferDetailId = & $_POST["transfer_detail_id"];               $_x_mode = "Edit";          }                   if ($err_code == 0) {                               $dbTable = "logistik_transfer_stok_detail";                              $dbField[0] = "transfer_detail_id";   // PK               $dbField[1] = "id_item";               $dbField[2] = "transfer_detail_jumlah";               $dbField[3] = "id_transfer";               $dbField[4] = "id_dep";               $dbField[5] = "id_batch";      			               if(!$transferBufferDetailId) $transferBufferDetailId = $dtaccess->GetTransId();               $dbValue[0] = QuoteValue(DPE_CHAR,$transferBufferDetailId);               $dbValue[1] = QuoteValue(DPE_CHAR,$_POST["item_id"]);               $dbValue[2] = QuoteValue(DPE_NUMERIC,StripCurrency($_POST["transfer_detail_jumlah"]));               $dbValue[3] = QuoteValue(DPE_CHAR,$transferId);               $dbValue[4] = QuoteValue(DPE_CHAR,$_POST["klinik"]);			         $dbValue[5] = QuoteValue(DPE_CHAR,$_POST["id_batch"]);			                        $dbKey[0] = 0; // -- set key buat clause wherenya , valuenya = index array buat field / value               $dtmodel = new DataModel($dbTable,$dbField,$dbValue,$dbKey,DB_SCHEMA_LOGISTIK);                  if ($_POST["btnSave"] || $_POST["btnSaveLagi"]) {                    $dtmodel->Insert() or die("insert  error");	                                 } else if ($_POST["btnUpdate"] || $_POST["btnUpdateLagi"]) {                    $dtmodel->Update() or die("update  error");	               }                  unset($dtmodel);                  unset($dbField);                  unset($dbValue);                  unset($dbKey);                                 header("location:".$backPage);                  exit();          }     }                 if ($_POST["btnDelete"]) {          $transferBufferDetailId = & $_POST["cbDelete"];                    for($i=0,$n=count($transferBufferDetailId);$i<$n;$i++){               $sql = "delete from logistik_transfer_stok_detail                        where transfer_detail_id = ".QuoteValue(DPE_CHAR,$transferBufferDetailId[$i]);               $dtaccess->Execute($sql,DB_SCHEMA_LOGISTIK);          }                    header("location:".$backPage);          exit();              }                  //Pindahkan semua Buffer ke dalam logistik_transfer_stok          if ($_POST["btnCetak"]) {                        // LANGAH PERTAMA CHECKING DAHULU //      // cek apakah item yg di masukkan lebih banyak atau pas //            $sql = "select a.id_item, a.id_batch, a.id_dep, a.id_transfer, b.id_asal              from logistik.logistik_transfer_stok_detail a left join              logistik.logistik_transfer_stok b on id_transfer = b.transfer_id              where a.id_transfer = ".QuoteValue(DPE_CHAR,$transferId)."               and a.id_dep = ".QuoteValue(DPE_CHAR,$_POST["klinik"]);      $rs = $dtaccess->Execute($sql,DB_SCHEMA_LOGISTIK);      $dataStokBuffer = $dtaccess->FetchAll($rs);            // Cek ada apa gak datanya, kalau gaka da di kasih warning saja //      if(!$dataStokBuffer)  {             // Tampilkan warning kalau gak ada datanya..             echo "<script>alert('Maaf , Belum ada Item Barang yang di masukkan');</script>";             echo "<script>document.location.href='transfer_stok_detail_view.php?klinik=".$_POST["klinik"]."&id=".$enc->Encode($transferId)."'</script>;";             exit();            }            for($i=0,$j=count($dataStokBuffer);$i<$j;$i++) {            // jika si user memasukan 2 item batch yg sama maka di ambil salah satu dahulu utk di cek //       if($dataStokBuffer[$i]["id_batch"]!=$dataStokBuffer[$i-1]["id_batch"]) {                 // Cek total stok yg akan di trasfer ke gudang tujuan //          $sql = "select sum(transfer_detail_jumlah) as total from logistik.logistik_transfer_stok_detail                  where id_batch = ".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_batch"])." and id_dep = ".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_dep"])." and id_transfer =".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_transfer"]);          $rs = $dtaccess->Execute($sql,DB_SCHEMA_LOGISTIK);          $dataTransStokuff = $dtaccess->Fetch($rs);                   // Cek total Saldo di tabel item Batch //          $sql = "select sum(stok_batch_dep_saldo) as total from logistik.logistik_stok_batch_dep                  where id_batch = ".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_batch"]).                  " and id_gudang = ".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_asal"]);          $rs = $dtaccess->Execute($sql,DB_SCHEMA_LOGISTIK);          $dataStokBatch = $dtaccess->Fetch($rs);                    // Checking apakah Stok yg di masukkan tidak kelebihan . more than, oh no !!! -,-          /*if($dataTransStokuff["total"]>$dataStokBatch["total"]) {              //echo $sql;              //die();             // Lihat Nama Item , No. Batch yg terkena penalty krn kebanyakan //             $sql = "select item_nama, batch_no from logistik.logistik_item a                     join logistik.logistik_item_batch b on b.id_item = a.item_id                     where b.batch_id = ".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_batch"])." and b.id_dep = ".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_dep"]);             $rs = $dtaccess->Execute($sql,DB_SCHEMA_LOGISTIK);             $dataStokBatchAlert = $dtaccess->Fetch($rs);                          // kasih alert biar si user mengerti kalau si dy input kelebihan //                    echo "<script>alert('Maaf data yang akan ditransfer terlalu banyak, ITEM : ".$dataStokBatchAlert["item_nama"].", BATCH NO : ".$dataStokBatchAlert["batch_no"].", MAX. STOK : ".currency_format($dataStokBatch["total"])."');</script>";             echo "<script>document.location.href='transfer_stok_detail_view.php?klinik=".$_POST["klinik"]."&id=".$enc->Encode($transferId)."'</script>;";             exit();                     } */                                   }                       }            //die();            // LANGKAH KEDUA UPDATE DATA BATCH NYA//      // cek kembali apakah item yg di masukkan lebih banyak atau pas //            $sql = "select a.id_item, a.id_batch, a.id_dep, a.id_transfer,  b.*               from logistik.logistik_transfer_stok_detail a              left join logistik.logistik_item_batch b on b.batch_id = a.id_batch              where a.id_transfer = ".QuoteValue(DPE_CHAR,$transferId)." and               a.id_dep = ".QuoteValue(DPE_CHAR,$_POST["klinik"]);      $rs = $dtaccess->Execute($sql,DB_SCHEMA_LOGISTIK);      $dataStokBufferx = $dtaccess->FetchAll($rs);            for($i=0,$j=count($dataStokBufferx);$i<$j;$i++) {      // jika si user memasukan 2 item batch yg sama maka di ambil salah satu dahulu utk di cek //       if($dataStokBufferx[$i]["id_batch"]!=$dataStokBufferx[$i-1]["id_batch"]) {                           //Ambil Data Transfer Stok          $sql = "select * from logistik_transfer_stok                  where transfer_id = ".QuoteValue(DPE_CHAR,$transferId)." and id_dep = ".QuoteValue(DPE_CHAR,$_POST["klinik"]);          $rs = $dtaccess->Execute($sql,DB_SCHEMA_LOGISTIK);          $dataTransfer = $dtaccess->Fetch($rs);                    //Isi Data-data yang diperlukan          $_POST["id_tujuan"]=$dataTransfer["id_tujuan"];   // ke          $_POST["id_asal"]=$dataTransfer["id_asal"];      // dari                // Cek total stok yg akan di trasfer ke gudang tujuan //          $sql = "select sum(transfer_detail_jumlah) as total from logistik.logistik_transfer_stok_detail                  where id_batch = ".QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_batch"])." and id_dep = ".QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_dep"])." and id_transfer =".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_transfer"]);          $rs = $dtaccess->Execute($sql,DB_SCHEMA_LOGISTIK);          $dataTransStokuffx = $dtaccess->Fetch($rs);                   // Cek total Saldo di tabel item Batch //          $sql = "select sum(stok_batch_dep_saldo) as total from logistik.logistik_stok_batch_dep                  where id_batch = ".QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_batch"]).                  " and id_dep = ".QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_dep"]).                  " and id_gudang =".QuoteValue(DPE_CHAR,$_POST["id_asal"]);          $rs = $dtaccess->Execute($sql,DB_SCHEMA_LOGISTIK);          $dataStokBatchx = $dtaccess->Fetch($rs);                    // Ngurangi total stok yg di transfer //            $stokHasil[$i] = $dataStokBatchx["total"] - $dataTransStokuffx["total"];                              /*               // Update stok terbaru ke logistik item batch, hasil dari pengurangan ke transfer stok //            $sql = "update logistik.logistik_stok_batch_dep set                     stok_batch_dep_saldo = ".QuoteValue(DPE_NUMERIC,$stokHasil[$i])."                    where id_batch = ".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_batch"]).                    " and id_dep = ".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_dep"])."                     and id_gudang =".QuoteValue(DPE_CHAR,$_POST["id_asal"]);            $rs = $dtaccess->Execute($sql);                        // Jika stok batch sudah jd 0, maka status di update //            if($stokHasil[$i]=='0.00') {            $sql = "update logistik.logistik_item_batch set batch_status = ".QuoteValue(DPE_CHAR,'n')."                    where batch_id = ".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_batch"])." and id_dep = ".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_dep"])." and id_gudang =".QuoteValue(DPE_CHAR,$_POST["id_asal"]);            $rs = $dtaccess->Execute($sql);                        }   */                                       // Langkah Ketiga           //Update data terbaru ke logistik transfer Stok      $dbTable = "logistik_transfer_stok";                      $dbField[0] = "transfer_id";   // PK       $dbField[1] = "transfer_no";       $dbField[2] = "transfer_nomor";       $dbField[3] = "transfer_tanggal_permintaan";       $dbField[4] = "transfer_pengirim";       $dbField[5] = "transfer_penerima";       $dbField[6] = "transfer_asal";       $dbField[7] = "transfer_tanggal_keluar";       $dbField[8] = "transfer_keterangan";       $dbField[9] = "id_asal";       $dbField[10] = "id_tujuan";       $dbField[11] = "id_dep";              $dbValue[0] = QuoteValue(DPE_CHAR,$dataTransfer["transfer_id"]);       $dbValue[1] = QuoteValue(DPE_NUMERIC,$dataTransfer["transfer_no"]);       $dbValue[2] = QuoteValue(DPE_CHAR,$dataTransfer["transfer_nomor"]);       $dbValue[3] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_permintaan"]);       $dbValue[4] = QuoteValue(DPE_CHAR,$dataTransfer["transfer_pengirim"]);       $dbValue[5] = QuoteValue(DPE_CHAR,$dataTransfer["transfer_penerima"]);       $dbValue[6] = QuoteValue(DPE_CHAR,$dataTransfer["transfer_asal"]);       $dbValue[7] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]);       $dbValue[8] = QuoteValue(DPE_CHAR,$dataTransfer["transfer_keterangan"]);       $dbValue[9] = QuoteValue(DPE_CHAR,$dataTransfer["id_asal"]);       $dbValue[10] = QuoteValue(DPE_CHAR,$dataTransfer["id_tujuan"]);       $dbValue[11] = QuoteValue(DPE_CHAR,$_POST["klinik"]);         $dbKey[0] = 0; // -- set key buat clause wherenya , valuenya = index array buat field / value       $dtmodel = new DataModel($dbTable,$dbField,$dbValue,$dbKey,DB_SCHEMA_LOGISTIK);         $dtmodel->Update() or die("insert  error");	           unset($dtmodel);       unset($dbField);       unset($dbValue);       unset($dbKey);                  //Ambil Data Transfer Detail Stok      //$sql = "select * from logistik_transfer_stok_detail      //        where id_transfer = ".QuoteValue(DPE_CHAR,$transferId)." AND id_dep =".QuoteValue(DPE_CHAR,$_POST["klinik"]);      //$rs = $dtaccess->Execute($sql,DB_SCHEMA_LOGISTIK);      //$dataTransferDetail = $dtaccess->FetchAll($rs);            //Update Semua data Barang yang di Transfer Item      //for($i=0,$j=count($dataTransferDetail);$i<$j;$i++)      //{                //Hitung stok obat ini di tujuan -- ||          $sql = "select stok_item_saldo from logistik.logistik_stok_item where id_gudang =".QuoteValue(DPE_CHAR,$_POST["id_tujuan"]);         $sql .="and id_item =".QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"])." and id_dep =".QuoteValue(DPE_CHAR,$_POST["klinik"]);         $sql .="order by stok_item_create desc";              $rs = $dtaccess->Execute($sql);         $dataStokTujuan = $dtaccess->Fetch($rs);                      //$jumlahStokTujuan - jumlah di stok_tujuan        if($dataStokTujuan["stok_item_saldo"]) $jumlahStokTujuan = $dataStokTujuan["stok_item_saldo"] + $dataTransStokuffx["total"];         if(!$dataStokTujuan["stok_item_saldo"]) $jumlahStokTujuan = $dataTransStokuffx["total"];                                              $stokid = $dtaccess->GetTransID();          $date = date('Y-m-d H:i:s');                           $dbTable = "logistik.logistik_stok_item";          $dbField[0]  = "stok_item_id";   // PK          $dbField[1]  = "stok_item_jumlah";          $dbField[2]  = "id_item";              $dbField[3]  = "id_gudang";          $dbField[4]  = "stok_item_flag";          $dbField[5]  = "stok_item_create";          $dbField[6]  = "stok_item_saldo";          $dbField[7]  = "id_dep_asal";          $dbField[8]  = "id_dep";          $dbField[9]  = "id_transfer";          $dbField[10]  = "stok_item_keterangan";                    $dbValue[0] = QuoteValue(DPE_CHAR,$stokid);          $dbValue[1] = QuoteValue(DPE_NUMERIC,$dataTransStokuffx["total"]);            $dbValue[2] = QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);          $dbValue[3] = QuoteValue(DPE_CHAR,$_POST["id_tujuan"]);   //departemen tujuan                   $dbValue[4] = QuoteValue(DPE_CHAR,'T');          $dbValue[5] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]." ".date("H:i:s"));          $dbValue[6] = QuoteValue(DPE_NUMERIC,$jumlahStokTujuan);           $dbValue[7] = QuoteValue(DPE_CHAR,$_POST["id_asal"]);          $dbValue[8] = QuoteValue(DPE_CHAR,$_POST["klinik"]);          $dbValue[9] = QuoteValue(DPE_CHAR,$dataTransfer["transfer_id"]);          $dbValue[10] = QuoteValue(DPE_CHAR,$dataTransfer["transfer_nomor"]);                    $dbKey[0] = 0; // -- set key buat clause wherenya , valuenya = index array buat field / value          $dtmodel = new DataModel($dbTable,$dbField,$dbValue,$dbKey,DB_SCHEMA_LOGISTIK);          $dtmodel->Insert() or die("insert  error");	          unset($dbTable);          unset($dbField);          unset($dbValue);          unset($dbKey);                   //Hitung stok obat batch ini di tujuan -- ||          $sql = "select stok_item_batch_saldo from logistik.logistik_stok_item_batch where id_gudang =".QuoteValue(DPE_CHAR,$_POST["id_tujuan"]);         $sql .=" and id_item =".QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);         $sql .=" and id_batch =".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_batch"]);         $sql .=" and id_dep =".QuoteValue(DPE_CHAR,$_POST["klinik"]);         $sql .="order by stok_item_batch_create desc";                $rs = $dtaccess->Execute($sql);         $dataStokBatchTujuan = $dtaccess->Fetch($rs);                      //$jumlahStokTujuan - jumlah di stok_tujuan        if($dataStokBatchTujuan["stok_item_batch_saldo"]) $jumlahStokBatchTujuan = $dataStokBatchTujuan["stok_item_batch_saldo"] + $dataTransStokuffx["total"];         if(!$dataStokBatchTujuan["stok_item_batch_saldo"]) $jumlahStokBatchTujuan = $dataTransStokuffx["total"];          //insert logistik_stok_item_bacth tujuan          $dbTable = "logistik.logistik_stok_item_batch";          $dbField[0]  = "stok_item_batch_id";   // PK          $dbField[1]  = "stok_item_batch_jumlah";          $dbField[2]  = "id_item";              $dbField[3]  = "id_gudang";          $dbField[4]  = "stok_item_batch_flag";          $dbField[5]  = "stok_item_batch_create";          $dbField[6]  = "stok_item_batch_saldo";          $dbField[7]  = "id_dep_asal";          $dbField[8]  = "id_dep";          $dbField[9]  = "id_transfer";          $dbField[10]  = "stok_item_keterangan";          $dbField[11]  = "id_batch";          $dbField[12]  = "id_stok_item";                    $dbValue[0] = QuoteValue(DPE_CHAR,$stokid);          $dbValue[1] = QuoteValue(DPE_NUMERIC,$dataTransStokuffx["total"]);            $dbValue[2] = QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);          $dbValue[3] = QuoteValue(DPE_CHAR,$_POST["id_tujuan"]);   //departemen tujuan                   $dbValue[4] = QuoteValue(DPE_CHAR,'T');          $dbValue[5] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]." ".date("H:i:s"));          $dbValue[6] = QuoteValue(DPE_NUMERIC,$jumlahStokBatchTujuan);           $dbValue[7] = QuoteValue(DPE_CHAR,$_POST["id_asal"]);          $dbValue[8] = QuoteValue(DPE_CHAR,$_POST["klinik"]);          $dbValue[9] = QuoteValue(DPE_CHAR,$dataTransfer["transfer_id"]);          $dbValue[10] = QuoteValue(DPE_CHAR,$dataTransfer["transfer_nomor"]);          $dbValue[11] = QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_batch"]);          $dbValue[12] = QuoteValue(DPE_CHAR,$stokid);                              $dbKey[0] = 0; // -- set key buat clause wherenya , valuenya = index array buat field / value          $dtmodel = new DataModel($dbTable,$dbField,$dbValue,$dbKey,DB_SCHEMA_LOGISTIK);          $dtmodel->Insert() or die("insert  error");	          unset($dbTable);          unset($dbField);          unset($dbValue);          unset($dbKey);                     //Hitung stok obat ini di stok ASAL -- ||          $sql = "select stok_item_saldo from logistik.logistik_stok_item where id_gudang =".QuoteValue(DPE_CHAR,$_POST["id_asal"]);         $sql .="and id_item =".QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);         $sql .="order by stok_item_create desc";          $rs = $dtaccess->Execute($sql);         $dataStok = $dtaccess->Fetch($rs);            $last = $dataStok["stok_item_saldo"];         if($dataStok["stok_item_saldo"]) $jumlahStok = $dataStok["stok_item_saldo"] - $dataTransStokuffx["total"];         if(!$dataStok["stok_item_saldo"]) $jumlahStok = $dataTransStokuffx["total"];          $dbTable = "logistik.logistik_stok_item";          $dbField[0]  = "stok_item_id";   // PK          $dbField[1]  = "stok_item_jumlah";          $dbField[2]  = "id_item";              $dbField[3]  = "id_gudang";          $dbField[4]  = "stok_item_flag";          $dbField[5]  = "stok_item_create";          $dbField[6]  = "stok_item_saldo";          $dbField[7]  = "id_dep_tujuan";          $dbField[8]  = "id_dep";          $dbField[9]  = "id_transfer";          $dbField[10]  = "stok_item_keterangan";                    $stokid1 = $dtaccess->GetTransID();          $dbValue[0] = QuoteValue(DPE_CHAR,$stokid1);          $dbValue[1] = QuoteValue(DPE_NUMERIC,$dataTransStokuffx["total"]);           $dbValue[2] = QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);          $dbValue[3] = QuoteValue(DPE_CHAR,$_POST["id_asal"]);   //departemen asal                   $dbValue[4] = QuoteValue(DPE_CHAR,'T');          $dbValue[5] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]." ".date("H:i:s"));          $dbValue[6] = QuoteValue(DPE_NUMERIC,$jumlahStok);           $dbValue[7] = QuoteValue(DPE_CHAR,$_POST["id_tujuan"]);          $dbValue[8] = QuoteValue(DPE_CHAR,$_POST["klinik"]);          $dbValue[9] = QuoteValue(DPE_CHAR,$dataTransfer["transfer_id"]);          $dbValue[10] = QuoteValue(DPE_CHAR,"( SBBK No : ".$dataTransfer["transfer_nomor"].")");                    $dbKey[0] = 0; // -- set key buat clause wherenya , valuenya = index array buat field / value          $dtmodel = new DataModel($dbTable,$dbField,$dbValue,$dbKey,DB_SCHEMA_LOGISTIK);          $dtmodel->Insert() or die("insert  error");	          unset($dbTable);          unset($dbField);          unset($dbValue);          unset($dbKey);                        //Hitung stok batch obat ini di stok ASAL -- ||          $sql = "select stok_item_batch_saldo from logistik.logistik_stok_item_batch          where id_gudang =".QuoteValue(DPE_CHAR,$_POST["id_asal"]);         $sql .="and id_item =".QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);         $sql .="and id_batch =".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_batch"]);              $sql .="order by stok_item_batch_create desc";          $rs = $dtaccess->Execute($sql);         $dataStok = $dtaccess->Fetch($rs);            $last = $dataStok["stok_item_batch_saldo"];         if($dataStok["stok_item_batch_saldo"]) $jumlahStokBatch = $dataStok["stok_item_batch_saldo"] - $dataTransStokuffx["total"];         if(!$dataStok["stok_item_batch_saldo"]) $jumlahStokBatch = $dataTransStokuffx["total"];          //stok item batch asal          $dbTable = "logistik.logistik_stok_item_batch";          $dbField[0]  = "stok_item_batch_id";   // PK          $dbField[1]  = "stok_item_batch_jumlah";          $dbField[2]  = "id_item";              $dbField[3]  = "id_gudang";          $dbField[4]  = "stok_item_batch_flag";          $dbField[5]  = "stok_item_batch_create";          $dbField[6]  = "stok_item_batch_saldo";          $dbField[7]  = "id_dep_tujuan";          $dbField[8]  = "id_dep";          $dbField[9]  = "id_transfer";          $dbField[10]  = "stok_item_keterangan";          $dbField[11]  = "id_batch";          $dbField[12]  = "id_stok_item";          $dbValue[0] = QuoteValue(DPE_CHAR,$stokid1);          $dbValue[1] = QuoteValue(DPE_NUMERIC,$dataTransStokuffx["total"]);           $dbValue[2] = QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);          $dbValue[3] = QuoteValue(DPE_CHAR,$_POST["id_asal"]);   //departemen asal                   $dbValue[4] = QuoteValue(DPE_CHAR,'T');          $dbValue[5] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]." ".date("H:i:s"));          $dbValue[6] = QuoteValue(DPE_NUMERIC,$jumlahStokBatch);           $dbValue[7] = QuoteValue(DPE_CHAR,$_POST["id_tujuan"]);          $dbValue[8] = QuoteValue(DPE_CHAR,$_POST["klinik"]);          $dbValue[9] = QuoteValue(DPE_CHAR,$dataTransfer["transfer_id"]);          $dbValue[10] = QuoteValue(DPE_CHAR,"( SBBK No : ".$dataTransfer["transfer_nomor"].")");          $dbValue[11] = QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_batch"]);          $dbValue[12] = QuoteValue(DPE_CHAR,$stokid1);                    $dbKey[0] = 0; // -- set key buat clause wherenya , valuenya = index array buat field / value          $dtmodel = new DataModel($dbTable,$dbField,$dbValue,$dbKey,DB_SCHEMA_LOGISTIK);          $dtmodel->Insert() or die("insert  error");	          unset($dbTable);          unset($dbField);          unset($dbValue);          unset($dbKey);               //cek di stok_dep [dep_asal] ada item nya apa ga , jika ga ada maka di input jika ada update         $sql = "select id_item from logistik.logistik_stok_dep where id_gudang =".QuoteValue(DPE_CHAR,$_POST["id_asal"]);         $sql .="and id_item =".QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);         $sql .="order by stok_dep_create desc";          $rs = $dtaccess->Execute($sql);         $dataDepAsal = $dtaccess->Fetch($rs);                   if(!$dataDepAsal){                   $dbTable = "logistik.logistik_stok_dep";          $dbField[0]  = "stok_dep_id";   // PK          $dbField[1]  = "id_item";          $dbField[2]  = "stok_dep_saldo";          $dbField[3]  = "stok_dep_create";          $dbField[4]  = "stok_dep_tgl";              $dbField[5]  = "id_gudang";          $dbField[6]  = "id_dep";                    $depId = $dtaccess->GetTransID();          $dbValue[0] = QuoteValue(DPE_CHAR,$depId);          $dbValue[1] = QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);//QuoteValue(DPE_NUMERIC,StripCurrency($_POST['txtJumlah']));          $dbValue[2] = QuoteValue(DPE_NUMERIC,$jumlahStok);              $dbValue[3] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]." ".date("H:i:s"));          $dbValue[4] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]);          $dbValue[5] = QuoteValue(DPE_CHAR,$_POST["id_asal"]);          $dbValue[6] = QuoteValue(DPE_CHAR,$_POST["klinik"]);          $dbKey[0] = 0; // -- set key buat clause wherenya , valuenya = index array buat field / value          $dtmodel = new DataModel($dbTable,$dbField,$dbValue,$dbKey,DB_SCHEMA_LOGISTIK);                    $dtmodel->Insert() or die("insert  error");	                    unset($dbTable);          unset($dbField);          unset($dbValue);          unset($dbKey);                              }else{          $sql  ="update logistik.logistik_stok_dep           set stok_dep_saldo =".QuoteValue(DPE_NUMERIC,$jumlahStok);          $sql .=" , stok_dep_create = ".QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]." ".date("H:i:s"));          $sql .=" , stok_dep_tgl = ".QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]);          $sql .=" where id_item = ".QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);          $sql .=" and id_gudang =".QuoteValue(DPE_CHAR,$_POST["id_asal"]);          $rs = $dtaccess->Execute($sql,DB_SCHEMA);                        }          //cek di stok_batch dep [dep_asal] ada item nya apa ga , jika ga ada maka di input batch depnya jika ada update         $sql = "select stok_batch_dep_id,id_item from logistik.logistik_stok_batch_dep where                  id_gudang =".QuoteValue(DPE_CHAR,$_POST["id_asal"]);         $sql .="and id_item =".QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);         $sql .="and id_batch =".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_batch"]);         $sql .="order by stok_batch_dep_create desc";          $rs = $dtaccess->Execute($sql);         $dataBatchDepAsal = $dtaccess->Fetch($rs);          if(!$dataBatchDepAsal){                   $dbTable = "logistik.logistik_stok_batch_dep";          $dbField[0]  = "stok_batch_dep_id";   // PK          $dbField[1]  = "id_item";          $dbField[2]  = "stok_batch_dep_saldo";          $dbField[3]  = "stok_batch_dep_create";          $dbField[4]  = "stok_batch_dep_tgl";              $dbField[5]  = "id_gudang";          $dbField[6]  = "id_dep";          $dbField[7]  = "id_batch";                    $depId = $dtaccess->GetTransID();          $dbValue[0] = QuoteValue(DPE_CHAR,$depId);          $dbValue[1] = QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);//QuoteValue(DPE_NUMERIC,StripCurrency($_POST['txtJumlah']));          $dbValue[2] = QuoteValue(DPE_NUMERIC,$jumlahStokBatch);              $dbValue[3] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]." ".date("H:i:s"));          $dbValue[4] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]);          $dbValue[5] = QuoteValue(DPE_CHAR,$_POST["id_asal"]);          $dbValue[6] = QuoteValue(DPE_CHAR,$_POST["klinik"]);          $dbValue[7] = QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_batch"]);          $dbKey[0] = 0; // -- set key buat clause wherenya , valuenya = index array buat field / value          $dtmodel = new DataModel($dbTable,$dbField,$dbValue,$dbKey,DB_SCHEMA_LOGISTIK);                    $dtmodel->Insert() or die("insert  error");	                    unset($dbTable);          unset($dbField);          unset($dbValue);          unset($dbKey);                              }else{          $dbTable = "logistik.logistik_stok_batch_dep";          $dbField[0]  = "stok_batch_dep_id";   // PK          $dbField[1]  = "id_item";          $dbField[2]  = "stok_batch_dep_saldo";          $dbField[3]  = "stok_batch_dep_create";          $dbField[4]  = "stok_batch_dep_tgl";              $dbField[5]  = "id_gudang";          $dbField[6]  = "id_dep";          $dbField[7]  = "id_batch";                    $dbValue[0] = QuoteValue(DPE_CHAR,$dataBatchDepAsal["stok_batch_dep_id"]);          $dbValue[1] = QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);//QuoteValue(DPE_NUMERIC,StripCurrency($_POST['txtJumlah']));          $dbValue[2] = QuoteValue(DPE_NUMERIC,$jumlahStokBatch);              $dbValue[3] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]." ".date("H:i:s"));          $dbValue[4] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]);          $dbValue[5] = QuoteValue(DPE_CHAR,$_POST["id_asal"]);          $dbValue[6] = QuoteValue(DPE_CHAR,$_POST["klinik"]);          $dbValue[7] = QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_batch"]);          $dbKey[0] = 0; // -- set key buat clause wherenya , valuenya = index array buat field / value          $dtmodel = new DataModel($dbTable,$dbField,$dbValue,$dbKey,DB_SCHEMA_LOGISTIK);                    $dtmodel->Update() or die("insert  error");	                    unset($dbTable);          unset($dbField);          unset($dbValue);          unset($dbKey);          }          //cek di stok_dep [dep_tujuan] ada item nya apa ga , jika ga ada maka di input jika ada update         $sql = "select id_item from logistik.logistik_stok_dep where id_gudang =".QuoteValue(DPE_CHAR,$_POST["id_tujuan"]);         $sql .="and id_item =".QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);         $sql .="order by stok_dep_create desc";          $rs = $dtaccess->Execute($sql);         $dataDepTujuan = $dtaccess->Fetch($rs);                    if(!$dataDepTujuan){                   $dbTable = "logistik.logistik_stok_dep";          $dbField[0]  = "stok_dep_id";   // PK          $dbField[1]  = "id_item";          $dbField[2]  = "stok_dep_saldo";          $dbField[3]  = "stok_dep_create";          $dbField[4]  = "stok_dep_tgl";              $dbField[5]  = "id_gudang";          $dbField[6]  = "id_dep";                    $depId2 = $dtaccess->GetTransID();          $dbValue[0] = QuoteValue(DPE_CHAR,$depId2);          $dbValue[1] = QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);//QuoteValue(DPE_NUMERIC,StripCurrency($_POST['txtJumlah']));          $dbValue[2] = QuoteValue(DPE_NUMERIC,$jumlahStokTujuan);              $dbValue[3] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]." ".date("H:i:s"));          $dbValue[4] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]);          $dbValue[5] = QuoteValue(DPE_CHAR,$_POST["id_tujuan"]);          $dbValue[6] = QuoteValue(DPE_CHAR,$_POST["klinik"]);          $dbKey[0] = 0; // -- set key buat clause wherenya , valuenya = index array buat field / value          $dtmodel = new DataModel($dbTable,$dbField,$dbValue,$dbKey,DB_SCHEMA_LOGISTIK);                    $dtmodel->Insert() or die("insert  error");	                    unset($dbTable);          unset($dbField);          unset($dbValue);          unset($dbKey);                              }else{          $sql  ="update logistik.logistik_stok_dep set stok_dep_saldo =".QuoteValue(DPE_NUMERIC,$jumlahStokTujuan);          $sql .=" , stok_dep_create = ".QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]." ".date("H:i:s"));          $sql .=" , stok_dep_tgl = ".QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]);          $sql .=" where id_item = ".QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);          $sql .=" and id_gudang =".QuoteValue(DPE_CHAR,$_POST["id_tujuan"]);          $rs = $dtaccess->Execute($sql,DB_SCHEMA);                        }               //cek di stok_dep [dep_tujuan] ada item nya apa ga , jika ga ada maka di input jika ada update         $sql = "select id_item from logistik.logistik_stok_batch_dep where id_gudang =".QuoteValue(DPE_CHAR,$_POST["id_tujuan"]);         $sql .="and id_item =".QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);         $sql .="and id_batch =".QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_batch"]);         $sql .="order by stok_batch_dep_create desc";          $rs = $dtaccess->Execute($sql);         $dataBatchDepTujuan = $dtaccess->Fetch($rs);          if(!$dataBatchDepTujuan){                   $dbTable = "logistik.logistik_stok_batch_dep";          $dbField[0]  = "stok_batch_dep_id";   // PK          $dbField[1]  = "id_item";          $dbField[2]  = "stok_batch_dep_saldo";          $dbField[3]  = "stok_batch_dep_create";          $dbField[4]  = "stok_batch_dep_tgl";              $dbField[5]  = "id_gudang";          $dbField[6]  = "id_dep";          $dbField[7]  = "id_batch";                    $depId2 = $dtaccess->GetTransID();          $dbValue[0] = QuoteValue(DPE_CHAR,$depId2);          $dbValue[1] = QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);//QuoteValue(DPE_NUMERIC,StripCurrency($_POST['txtJumlah']));          $dbValue[2] = QuoteValue(DPE_NUMERIC,$jumlahStokBatchTujuan);              $dbValue[3] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]." ".date("H:i:s"));          $dbValue[4] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]);          $dbValue[5] = QuoteValue(DPE_CHAR,$_POST["id_tujuan"]);          $dbValue[6] = QuoteValue(DPE_CHAR,$_POST["klinik"]);          $dbValue[7] = QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_batch"]);          $dbKey[0] = 0; // -- set key buat clause wherenya , valuenya = index array buat field / value          $dtmodel = new DataModel($dbTable,$dbField,$dbValue,$dbKey,DB_SCHEMA_LOGISTIK);                    $dtmodel->Insert() or die("insert  error");	                    unset($dbTable);          unset($dbField);          unset($dbValue);          unset($dbKey);                              }else{          $dbTable = "logistik.logistik_stok_batch_dep";          $dbField[0]  = "stok_batch_dep_id";   // PK          $dbField[1]  = "id_item";          $dbField[2]  = "stok_batch_dep_saldo";          $dbField[3]  = "stok_batch_dep_create";          $dbField[4]  = "stok_batch_dep_tgl";              $dbField[5]  = "id_gudang";          $dbField[6]  = "id_dep";          $dbField[7]  = "id_batch";                    $dbValue[0] = QuoteValue(DPE_CHAR,$dataBatchDepTujuan["stok_batch_dep_id"]);          $dbValue[1] = QuoteValue(DPE_CHAR,$dataStokBufferx[$i]["id_item"]);//QuoteValue(DPE_NUMERIC,StripCurrency($_POST['txtJumlah']));          $dbValue[2] = QuoteValue(DPE_NUMERIC,$jumlahStokBatchTujuan);              $dbValue[3] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]." ".date("H:i:s"));          $dbValue[4] = QuoteValue(DPE_DATE,$dataTransfer["transfer_tanggal_keluar"]);          $dbValue[5] = QuoteValue(DPE_CHAR,$_POST["id_asal"]);          $dbValue[6] = QuoteValue(DPE_CHAR,$_POST["klinik"]);          $dbValue[7] = QuoteValue(DPE_CHAR,$dataStokBuffer[$i]["id_batch"]);          $dbKey[0] = 0; // -- set key buat clause wherenya , valuenya = index array buat field / value          $dtmodel = new DataModel($dbTable,$dbField,$dbValue,$dbKey,DB_SCHEMA_LOGISTIK);                    $dtmodel->Update() or die("insert  error");	                    unset($dbTable);          unset($dbField);          unset($dbValue);          unset($dbKey);          }               //update logistik_faktur          $sql  ="update logistik.logistik_transfer_stok set transfer_flag = ".QuoteValue(DPE_CHAR,'y');          $sql .=" where transfer_id = ".QuoteValue(DPE_CHAR,$transferId);           $rs = $dtaccess->Execute($sql,DB_SCHEMA);                       //}     // End For Item detail       }                     }                  $cetak = "OK";     } //End fungsi cteak               //-- bikin combo box untuk Asal --//     $sql = "select * from logistik.logistik_gudang where gudang_tipe='G' order by gudang_id";     $rs = $dtaccess->Execute($sql,DB_SCHEMA);          unset($asal);$i=1;     $asal[0] = $view->RenderOption("--","[Pilih Asal]",$show);     while($data_asal = $dtaccess->Fetch($rs)){     unset($show);        if($data_asal["gudang_id"] == $_POST["id_asal"]) $show="selected";        $asal[$i] = $view->RenderOption($data_asal["gudang_id"],$data_asal["gudang_nama"],$show);        $i++;     }          //-- bikin combo box untuk Tujuan --//     $sql = "select * from logistik.logistik_gudang order by gudang_id";     $rs = $dtaccess->Execute($sql,DB_SCHEMA);          unset($tujuan);$i=1;     $tujuan[0] = $view->RenderOption("--","[Pilih Tujuan]",$show);     while($data_tujuan = $dtaccess->Fetch($rs)){     unset($show);        if($data_tujuan["gudang_id"] == $_POST["id_tujuan"]) $show="selected";        $tujuan[$i] = $view->RenderOption($data_tujuan["gudang_id"],$data_tujuan["gudang_nama"],$show);        $i++;     }        ?><?php echo $view->InitThickBox(); ?><script language="javascript" type="text/javascript">var _wnd_new;function BukaWindow(url,judul){    if(!_wnd_new) {			_wnd_new = window.open(url,judul,'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=no,width=900,height=600,left=100,top=100');	} else {		if (_wnd_new.closed) {			_wnd_new = window.open(url,judul,'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=no,width=(00,height=600,left=100,top=100');		} else {			_wnd_new.focus();		}	}     return false;}function CheckDataSave(frm){        if(!frm.transfer_nomor.value){		alert('No. Transfer Harus Diisi');		frm.po_nomor.focus();          return false;	}	  document.frmEdit.submit();         }<?php if($cetak){?>BukaWindow('transfer_cetak.php?id=<?php echo $enc->Encode($transferId) ;?>','Pemakaian Logistik');document.location.href='<?php echo $transferPage;?>';<?php }?></script><div id="header"><table border="0" width="100%" valign="top"><tr><td width="10%" align="left" valign="top"><a href="http://sikita.net" target="_blank"><img src="<?php echo $APLICATION_ROOT;?>gambar/sikitalogo.png"/></a></td><td width="90%" valign="top" align="right"><a href="#" target="_blank"><font size="6">Detail Pengiriman Barang</font></a>&nbsp;&nbsp;</td></tr></table></div><div id="body"><div id="scroller"><form name="frmEdit" method="POST" action="<?php echo $_SERVER["PHP_SELF"]?>"><table width="70%" border="1" cellpadding="1" cellspacing="1"><tr>     <td>     <fieldset>     <legend><strong>Detail Pengiriman Barang</strong></legend>     <table width="100%" border="1" cellpadding="1" cellspacing="1">          <tr>                    <td align="left" width="30%" class="tablecontent">&nbsp;Nama Barang&nbsp;</td>                    <td align="left" width="70%" class="tablecontent-odd">                      <?php echo $view->RenderTextBox("item_nama","item_nama","30","100",$_POST["item_nama"],"inputField", "readonly",false);?>                                      <input type="hidden" name="item_id" id="item_id" value="<?php echo $_POST["item_id"];?>" />                      <input type="hidden" name="id_batch" id="id_batch" value="<?php echo $_POST["id_batch"];?>" />                      <a href="<?php echo $findPage;?>&TB_iframe=true&height=400&width=450&modal=true&outlet=<?php echo $outlet; ?>" class="thickbox" title="Pilih item"><img src="<?php echo $APLICATION_ROOT;?>gambar/b_select.png" border="0" align="middle" width="22" height="22" style="cursor:pointer" title="Pilih item" alt="Pilih item" /></a>                    </td>               </tr>               <tr>                    <td align="left" class="tablecontent" width="20%">&nbsp;Jenis Barang</td>                    <td align="left" class="tablecontent-odd"><?php echo $view->RenderTextBox("jenis_nama","jenis_nama","30","100",$_POST["jenis_nama"],"inputField", "readonly",false);?></td>               </tr>                <tr>                    <td align="left" class="tablecontent" width="20%">&nbsp;No. Batch</td>                    <td align="left" class="tablecontent-odd"><input type="text" name="nomor_batch" size="15" id="nomor_batch" readonly value="<?php echo $_POST["nomor_batch"];?>" /></td>               </tr>               <tr>                    <td align="left" class="tablecontent" width="20%">&nbsp;Expire Date</td>                    <td align="left" class="tablecontent-odd"><input type="text" name="exp_date_batch" size="10" id="exp_date_batch" readonly value="<?php echo $_POST["exp_date_batch"];?>" /></td>               </tr>               <tr>                    <td align="left" width="30%" class="tablecontent">&nbsp;Sisa Stok</td>                    <td align="left" width="70%" class="tablecontent-odd">                         <?php echo $view->RenderTextBox("stok","stok","10","10",$_POST["stok"],"inputField", "readonly",false);?>                    </td>					               </tr>               <tr>                    <td align="left" width="30%" class="tablecontent">&nbsp;Jumlah</td>                    <td align="left" width="70%" class="tablecontent-odd">                         <?php echo $view->RenderTextBox("transfer_detail_jumlah","transfer_detail_jumlah","6","6",$_POST["transfer_detail_jumlah"],"curedit", null,true);?>                    </td>					               </tr>               <tr>                    <td colspan="4" align="left" class="tblCol">                         <?php echo $view->RenderButton(BTN_SUBMIT,($_x_mode == "Edit")?"btnUpdate":"btnSave","btnSave","Simpan","submit",false,"onClick=\"javascript:return CheckDataSave(document.frmEdit);\"");?>                         <!--<?php// echo $view->RenderButton(BTN_SUBMIT,($_x_mode == "Edit")?"btnUpdateLagi":"btnSaveLagi","btnSaveLagi","Simpan & Input Lagi","submit",false,"onClick=\"javascript:return CheckDataSave(document.frmEdit);\"");?>   -->                         <input type="button" name="btnBack2" value="Kembali" class="submit" onClick="document.location.href='<?php echo $backPage?>'">                                             </td>               </tr>                </table>     </fieldset>     </td></tr></table><script>document.frmEdit.transfer_nomor.focus();</script><? if (($_x_mode == "Edit") || ($_x_mode == "Delete")) { ?><?php echo $view->RenderHidden("transfer_detail_id","transfer_detail_id",$transferBufferDetailId);?><?php echo $view->RenderHidden("klinik","klinik",$_POST["klinik"]);?><? } ?><?php echo $view->RenderHidden("tgl_keluar","tgl_keluar",$_POST["tgl_keluar"]);?><?php echo $view->RenderHidden("x_mode","x_mode",$_x_mode);?><?php echo $view->RenderHidden("transfer_id","transfer_id",$transferId);?><?php echo $view->RenderHidden("klinik","klinik",$_POST["klinik"]);?></form></div></div>                                                                                                                                                                                                                    